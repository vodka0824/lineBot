# LINE Bot 系統完整說明手冊

## 1. 系統架構與權限概要

本機器人採用模組化設計，功能透過 `Handlers` 處理發送，並由 `Routes` 進行指令路由。系統設有嚴格的權限分級制度，確保功能僅開放給授權對象。

### 權限分級
1.  **一般用戶 (User)**: 可使用公開的生活資訊查詢功能 (如油價、匯率)。
2.  **已授權群組成員 (Authorized Group Member)**: 當群組完成註冊後，成員可使用娛樂、抽獎等功能。需額外開通特定功能模組 (天氣、餐廳、待辦)。
3.  **群組管理員 (Group Admin)**: 群組內的管理者 (通常為註冊者)，可開關群組內的功能模組。
4.  **系統管理員 (Admin)**: 擁有跨群組的管理權限。
5.  **超級管理員 (Super Admin)**: 最高權限，可產生註冊碼、管理員管理、以及在私訊中使用所有功能。

---

## 2. 功能模組與指令詳解

### 2.1 系統指令 (System)
| 指令 | 說明 | 權限 | 備註 |
| :--- | :--- | :--- | :--- |
| `指令` / `help` | 呼叫功能選單 (Flex Message) | 所有 | 內容依權限動態顯示 |
| `註冊 [代碼]` | 啟用群組授權 | 群組 | 需有效註冊碼 (8碼) |
| `註冊天氣 [代碼]` | 啟用天氣/空氣功能 | 群組 | 需有效天氣碼 (WX-...) |
| `註冊餐廳 [代碼]` | 啟用餐廳功能 | 群組 | 需有效餐廳碼 (Food-...) |
| `註冊待辦 [代碼]` | 啟用待辦功能 | 群組 | 需有效待辦碼 (Todo-...) |
| `開啟 [功能]` | 開啟特定功能 (如 AI, game) | 群組管理員 | |
| `關閉 [功能]` | 關閉特定功能 | 群組管理員 | |
| `查詢功能` | 列出目前群組開通的功能狀態 | 群組管理員 | |

### 2.2 金融與生活 (Public / Finance / Crawler)
| 指令 | 說明 | 範例 |
| :--- | :--- | :--- |
| `即時匯率` | 查詢各國貨幣即時匯率 | |
| `匯率 [金額] [幣別]` | 換算台幣至外幣 (或反之) | `匯率 1000 JPY` |
| `美金 [金額]` | 快速換算美金至台幣 | `美金 30` |
| `買[幣別] [金額]` | 計算用台幣購買外幣的成本 | `買日幣 5000` |
| `分唄[金額]` | 計算分唄分期期數金額 | `分唄20000` |
| `銀角[金額]` | 計算銀角分期期數金額 | `銀角20000` |
| `刷卡[金額]` | 計算信用卡分期金額 (含利息) | `刷卡20000` |
| `油價` | 查詢本週中油/台塑油價 | |
| `[星座] [期間]` | 查詢運勢 (今日/本週/本月) | `獅子 本週` |
| `電影` | 查詢近期上映電影 | |
| `股價 [代號/名稱]` | 查詢台股即時報價 | `股價 2330` |
| `分析 [代號/名稱]` | 查詢個股技術分析 (BestFourPoint) | `分析 2330` |
| `科技新聞` | 查詢最新 TechNews 新聞 | |
| `蘋果新聞` | 查詢蘋果日報即時新聞 | |
| `PTT熱門` | 查詢 PTT 熱門看板文章 | |

### 2.3 待辦事項 (Todo)
*需開通待辦權限 (私訊可直接使用)*

| 指令 | 說明 | 範例 |
| :--- | :--- | :--- |
| `待辦` | 列出所有待辦事項 | |
| `待辦 [事項]` | 新增一般待辦事項 (預設 Low) | `待辦 買牛奶` |
| `待辦 !高 [事項]` | 新增高優先級事項 (🔴) | `待辦 !高 繳費` |
| `待辦 [中] [事項]` | 新增中優先級事項 (🟡) | `待辦 [中] 整理房間` |
| `完成 [編號]` | 標記事項為完成 | `完成 1` |
| `刪除 [編號]` | 刪除事項 | `刪除 2` |
| `抽` / `抽待辦` | 隨機抽取一件未完成事項 | `抽` |

### 2.4 餐廳與美食 (Restaurant)
*需開通餐廳權限*

| 指令 | 說明 | 範例 |
| :--- | :--- | :--- |
| `吃什麼` | 隨機推薦已建立的餐廳，或提示搜尋 | |
| `吃什麼 附近` | 觸發位置請求，搜尋附近 Google 餐廳 | |
| `新增餐廳 [名稱]` | 將餐廳加入群組口袋名單 | `新增餐廳 鼎泰豐` |
| `刪除餐廳 [名稱]` | 移除口袋名單中的餐廳 | `刪除餐廳 鼎泰豐` |
| `餐廳清單` | 列出群組口袋名單 | |

### 2.5 天氣與空氣 (Weather)
*需開通天氣權限*

| 指令 | 說明 | 範例 |
| :--- | :--- | :--- |
| `天氣 [地區]` | 查詢天氣概況 (鄉鎮市區) | `天氣 板橋` |
| `空氣 [地區]` | 查詢空氣品質 (監測站) | `空氣 板橋` |

### 2.6 娛樂與互動 (Entertainment)
*需群組授權 或 超級管理員*

| 指令 | 說明 | 範例 |
| :--- | :--- | :--- |
| `AI [文字]` | 與 Gemini AI 對話 | `AI 講個笑話` |
| `幫我選 [A] [B]` | AI隨機決策 | `幫我選 睡覺 打電動` |
| `剪刀` / `石頭` / `布` | 與機器人猜拳 | `剪刀` |
| `抽獎 [關鍵字] [獎品] [人]` | 發起群組抽獎 (自動計時) | `抽獎 報名 奶茶 3` |
| `番號推薦` / `今晚看什麼` | 隨機抽取影片資訊 | |
| `黑絲` / `腳控` | 隨機抽取圖片 | |
| `排行榜` | 查看群組內圖片使用與發言排行 | |
| `講台語 [文字]` | 台語發音翻譯 (私訊限 Super Admin) | `講台語 你好` |

---

## 3. 超級管理員專區 (Super Admin)

超級管理員擁有最高權限，可於私訊中執行以下指令來管理系統。

### 3.1 註冊碼生成
此類指令用於產生供群組開通功能的代碼。

| 指令 | 說明 |
| :--- | :--- |
| `產生群組註冊碼` | 產生一組 8 碼基礎授權碼 (ABC12345) |
| `產生天氣註冊碼` | 產生天氣功能開通碼 (WX-...) |
| `產生餐廳註冊碼` | 產生餐廳功能開通碼 (FOOD-...) |
| `產生待辦註冊碼` | 產生待辦功能開通碼 (TODO-...) |

### 3.2 系統管理
| 指令 | 說明 |
| :--- | :--- |
| `管理員列表` | (管理員後台功能) |
| `AI`/`黑絲` 等 | 超級管理員在私訊即可直接使用所有群組功能 |

---

## 4. 檔案結構導覽

- `index.js`: 程式進入點，初始化 Bot Client 與 Express Server。
- `handlers/`:
    - `routes.js`: 核心路由定義，將關鍵字對應到各處理器。
    - `system.js`: 系統指令、Help 選單、註冊邏輯。
    - `auth.js`: 權限驗證核心。
    - `crawler.js`: 爬蟲 (油價、電影、新聞)。
    - `finance.js` / `currency.js` / `stock.js`: 金融相關。
    - `todo.js` / `restaurant.js` / `weather.js`: 擴充功能模組。
    - `ai.js` / `game.js` / `lottery.js` / `taigi.js`: 娛樂模組。
- `utils/`: 共用工具 (Firestore, Line SDK helper, caching)。
- `tests/`: 單元測試與驗證腳本。

---

*文件生成時間: 2025-12-29*
